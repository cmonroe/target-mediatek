// SPDX-License-Identifier: (GPL-2.0 OR MIT)
/*
 * Copyright (C) 2022 SmartRG Inc.
 * Author: Chad Monroe <chad.monroe@smartrg.com>
 */

#include "mt7986a-smartrg-bonanza-peak.dtsi"
#include "mt7986a-smartrg-SDG-861x-power-limits-r1-RCM-AU-NZ.dtsi"
#include "mt7986a-smartrg-SDG-861x-power-limits-r2-IC-CA.dtsi"
#include "mt7986a-smartrg-SDG-861x-power-limits-r3-ETSI-GB.dtsi"
#include "mt7986a-smartrg-SDG-861x-power-limits-r4-ETSI.dtsi"
#include "mt7986a-smartrg-SDG-861x-power-limits-r5-FCC-US.dtsi"

/ {
	model = "SmartRG SDG-8614";
	compatible = "smartrg,sdg-8614", "mediatek,mt7986a";

	/* SFP1 cage (WAN) */
	i2c_sfp1: i2c-gpio-0 {
		compatible = "i2c-gpio";
		sda-gpios = <&pio 62 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
		scl-gpios = <&pio 63 (GPIO_ACTIVE_HIGH | GPIO_OPEN_DRAIN)>;
		i2c-gpio,delay-us = <2>;
		#address-cells = <1>;
		#size-cells = <0>;
	};

	sfp1: sfp1 {
		compatible = "sff,sfp";
		i2c-bus = <&i2c_sfp1>;
		los-gpios = <&pio 20 GPIO_ACTIVE_HIGH>;
		mod-def0-gpios = <&pio 65 GPIO_ACTIVE_LOW>;
		rate-select0-gpios = <&pio 9 GPIO_ACTIVE_HIGH>;
		rate-select1-gpios = <&pio 28 GPIO_ACTIVE_HIGH>;
		tx-disable-gpios = <&pio 64 GPIO_ACTIVE_HIGH>;
		tx-fault-gpios = <&pio 7 GPIO_ACTIVE_HIGH>;
		maximum-power-milliwatt = <3000>;
	};
};

&leds {
	sfp_red {
		color = <LED_COLOR_ID_RED>;
		function = "sfp";
		gpios = <&pio 16 GPIO_ACTIVE_HIGH>;
	};

	sfp_green {
		color = <LED_COLOR_ID_GREEN>;
		function = "sfp";
		gpios = <&pio 19 GPIO_ACTIVE_HIGH>;
	};
};

&mux_sel {
	output-low;
	/delete-node/ output-high;
};

&gmac0 {
	fixed-link {
		speed = <2500>;
		full-duplex;
		pause;
	};
};

&gmac1 {
	sfp = <&sfp1>;
	managed = "in-band-status";
};

&mdio {
	switch: switch@1f {
		compatible = "mediatek,mt7531";
		reg = <0x1f>;
		reset-gpios = <&pio 5 GPIO_ACTIVE_HIGH>;

		mdio {
			#address-cells = <1>;
			#size-cells = <0>;

			swphy1: phy@1 {
				reg = <1>;
				mediatek,led-config = <
					0x21 0x8009 /* BASIC_CTRL */
					0x22 0x0000 /* ON_DURATION */
					0x23 0x0000 /* BLINK_DURATION */
					0x24 0xc001 /* LED0_ON_CTRL */
					0x25 0x0000 /* LED0_BLINK_CTRL */
					0x26 0xc006 /* LED1_ON_CTRL */
					0x27 0x0000 /* LED1_BLINK_CTRL */
				>;
			};

			swphy2: phy@2 {
				reg = <2>;
				mediatek,led-config = <
					0x21 0x8009 /* BASIC_CTRL */
					0x22 0x0000 /* ON_DURATION */
					0x23 0x0000 /* BLINK_DURATION */
					0x24 0xc001 /* LED0_ON_CTRL */
					0x25 0x0000 /* LED0_BLINK_CTRL */
					0x26 0xc006 /* LED1_ON_CTRL */
					0x27 0x0000 /* LED1_BLINK_CTRL */
				>;
			};

			swphy3: phy@3 {
				reg = <3>;
				mediatek,led-config = <
					0x21 0x8009 /* BASIC_CTRL */
					0x22 0x0000 /* ON_DURATION */
					0x23 0x0000 /* BLINK_DURATION */
					0x24 0xc001 /* LED0_ON_CTRL */
					0x25 0x0000 /* LED0_BLINK_CTRL */
					0x26 0xc006 /* LED1_ON_CTRL */
					0x27 0x0000 /* LED1_BLINK_CTRL */
				>;
			};
		};

		ports {
			#address-cells = <1>;
			#size-cells = <0>;

			port@1 {
				reg = <1>;
				label = "lan3";
				phy-handle = <&swphy1>;
			};

			port@2 {
				reg = <2>;
				label = "lan2";
				phy-handle = <&swphy2>;
			};

			port@3 {
				reg = <3>;
				label = "lan1";
				phy-handle = <&swphy3>;
			};

			port5: port@5 {
				reg = <5>;
				label = "lan4";

				phy-mode = "2500base-x";
				phy-handle = <&phy5>;
			};

			port@6 {
				reg = <6>;
				ethernet = <&gmac0>;
				phy-mode = "2500base-x";

				fixed-link {
					speed = <2500>;
					full-duplex;
					pause;
				};
			};
		};
	};
};

&wifi {
	ieee80211-freq-limit = <2400000 2500000>, <5170000 5835000>;
};
